{% extends 'base.html' %}

{% block head %}
<title>Index</title>
{% endblock %}

{% block main %}
<!-- Spinner -->
<div id="loading-spinner" class="spinner hidden"></div>

<section class="hero">
    <h2 class="welcome-msg">DakshaAI -
        <span class="welcome-small">
        <br>Get personalized quizzes, smart explanations, and <br>AI-powered guidance to <br>master any topic at your own pace.</span>
    </h2>
</section>

<div class="input-container">
    <div class="input-wrapper">
        <form class="input-form" action="/" method="POST">
            <input type="text" class="input-field" name="input-field" id="input-field" placeholder="What topic do you want to learn today?"/>
            <button class="input-btn">
                <span class="input-btn-icon">âžª</span>
            </button>
        </form>
    </div>
</div>

<section class="suggestion">
    <h3 class="suggestion-title">Start Your Learning Journey with:</h3>
    <div class="topics">
        <div class="topic-card">
            <span class="icon">ðŸ¤–<br></span>
            <span class="label">Machine Learning</span>
        </div>

        <div class="topic-card">
            <span class="icon">ðŸ§ <br></span>
            <span class="label">Psychology</span>
        </div>

        <div class="topic-card">
            <span class="icon">ðŸ’»<br></span>
            <span class="label">Web Design</span>
        </div>

        <div class="topic-card">
            <span class="icon">ðŸ§¬<br></span>
            <span class="label">Genetics</span>
        </div>

        <div class="topic-card">
            <span class="icon">âž—<br></span>
            <span class="label">Algebra</span>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
const spinner = document.getElementById("loading-spinner");

// Show spinner on form submit
document.querySelector(".input-form").addEventListener("submit", () => {
    spinner.classList.remove("hidden");
});

// Handle topic card interactions
document.querySelectorAll(".topic-card").forEach(card => {
    card.addEventListener("mouseenter", () => {
        card.style.backgroundColor = "lightgray";
        card.style.color = "black";
        card.style.cursor = "pointer";
    });

    card.addEventListener("mouseleave", () => {
        card.style.backgroundColor = "";
        card.style.color = "";
    });

    card.addEventListener("click", () => {
        spinner.classList.remove("hidden"); // Show spinner

        const topic = card.querySelector(".label").textContent.trim();
        fetch("{{ url_for('select_topic') }}", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ topic })
        })
        .then(res => res.json())
        .then(data => {
            if (data.redirect) {
                window.location.href = data.redirect;
            } else {
                console.error("No redirect in response:", data);
                spinner.classList.add("hidden");
            }
        })
        .catch(err => {
            console.error("Fetch error:", err);
            spinner.classList.add("hidden");
        });
    });
});

// Hide spinner on page load
window.addEventListener("load", () => {
    spinner.classList.add("hidden");
});
</script>
{% endblock %}
