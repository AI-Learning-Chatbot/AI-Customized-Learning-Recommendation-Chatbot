{% extends 'base.html' %}

{% block head %}
<title>Level</title>
{% endblock %}

{% block main %}
<div class="level-box">
    <h2 class="level-title">How well do you<br/>understand this {{ topic }}:</h2>
    <div class="level">
        <button class="level-btn">Beginner</button>
        <button class="level-btn">Intermediate</button>
        <button class="level-btn">Advanced</button>
    </div>
    <nav class="proceed-nav">
        <!-- Hidden initially -->
        <button class="quiz-btn" style="display:none;">Take Quiz</button> 
        <button class="chat-btn" style="display:none;">Chat</button> 
    </nav>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", () => {
    let selectedLevel = null;
    const quizBtn = document.querySelector(".quiz-btn");
    const chatBtn = document.querySelector(".chat-btn");
    const levelButtons = document.querySelectorAll(".level-btn");

    // Initially disable buttons
    quizBtn.disabled = true;
    chatBtn.disabled = true;
    quizBtn.classList.add("disabled-btn");
    chatBtn.classList.add("disabled-btn");

    // Handle level selection
    levelButtons.forEach(btn => {
        btn.addEventListener("click", () => {
            // Remove .selected from all
            levelButtons.forEach(b => b.classList.remove("selected"));
            // Add to clicked
            btn.classList.add("selected");
            selectedLevel = btn.textContent.trim();

            // Enable buttons
            quizBtn.disabled = false;
            chatBtn.disabled = false;
            quizBtn.classList.remove("disabled-btn");
            chatBtn.classList.remove("disabled-btn");
        });
    });

    // Quiz button click
    quizBtn.addEventListener("click", () => {
        if (!selectedLevel) return;
        fetch("{{ url_for('set_level') }}", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ level: selectedLevel, target: "quiz" })
        })
        .then(res => res.json())
        .then(data => {
            if (data.redirect) window.location.href = data.redirect;
        });
    });

    // Chat button click
    chatBtn.addEventListener("click", () => {
        if (!selectedLevel) return;
        fetch("{{ url_for('set_level') }}", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ level: selectedLevel, target: "chat" })
        })
        .then(res => res.json())
        .then(data => {
            if (data.redirect) window.location.href = data.redirect;
        });
    });
});
</script>
{% endblock %}
