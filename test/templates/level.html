{% extends 'base.html' %}

{% block head %}
<title>Level</title>
{% endblock %}

{% block main %}
<div class="level-box">
    <h2 class="level-title">How well do you<br/>understand this topic:</h2>
    <div class="level">
        <button class="level-btn">Beginner</button>
        <button class="level-btn">Intermediate</button>
        <button class="level-btn">Advanced</button>
    </div>
    <nav class="proceed-nav">
        <button class="quiz-btn disabled">Take Quiz</button> 
        <button class="chat-btn disabled">Chat</button> 
    </nav>
</div>
{% endblock %}

{% block scripts %}
<script>
let selectedLevel = null;
const quizBtn = document.querySelector(".quiz-btn");
const chatBtn = document.querySelector(".chat-btn");

// Exclusive selection for level buttons
document.querySelectorAll(".level-btn").forEach(btn => {
    btn.addEventListener("click", () => {
        // remove .selected from all
        document.querySelectorAll(".level-btn").forEach(b => b.classList.remove("selected"));
        // add to clicked
        btn.classList.add("selected");
        selectedLevel = btn.textContent.trim();
        //enable buttons
        quizBtn.disabled = false;
        chatBtn.disabled = false;
        quizBtn.classList.remove("disabled-btn");
        chatBtn.classList.remove("disabled-btn");
    });
});


let selectedLevel = null;
const quizBtn = document.querySelector(".quiz-btn");
const chatBtn = document.querySelector(".chat-btn");

// Exclusive selection for level buttons
document.querySelectorAll(".level-btn").forEach(btn => {
    btn.addEventListener("click", () => {
        // remove .selected from all
        document.querySelectorAll(".level-btn").forEach(b => b.classList.remove("selected"));
        // add to clicked
        btn.classList.add("selected");
        selectedLevel = btn.textContent.trim();

        // Enable buttons
        quizBtn.disabled = false;
        chatBtn.disabled = false;
        quizBtn.classList.remove("disabled-btn");
        chatBtn.classList.remove("disabled-btn");
    });
});

// Quiz button click
quizBtn.addEventListener("click", () => {
    if (!selectedLevel) return;
    fetch("{{ url_for('set_level') }}", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ level: selectedLevel, target: "quiz" })
    })
    .then(res => res.json())
    .then(data => {
        if (data.redirect) window.location.href = data.redirect;
    });
});

// Chat button click
chatBtn.addEventListener("click", () => {
    if (!selectedLevel) return;
    fetch("{{ url_for('set_level') }}", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ level: selectedLevel, target: "chat" })
    })
    .then(res => res.json())
    .then(data => {
        if (data.redirect) window.location.href = data.redirect;
    });
});
</script>
{% endblock %}

